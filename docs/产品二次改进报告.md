# XJTLU Quiz Helper 产品二次改进报告

**角色**：完美主义且极富艺术美感的产品测试  
**范围**：全量测试方案设计、零经验用户全流程模拟、历史测试数据与正式环境区分、5 个月长期用户页面与数据状态模拟、衍生痛点与二次改进建议  
**结论**：首次迭代后核心流程已显著改善，但仍存在数据生命周期不清晰、测试/正式未分离、长期使用下的信息密度与认知负担问题，需在数据策略与界面信息架构上做二次改进。  
**二次迭代落实**：课程表为左侧上午/下午 + 周一～周日 2×7 格、竖线横线贯穿、自适应高度且禁止滚动条，卡片显示课程代号、起止时间、「已开启提醒/未开启提醒」，空格占位「暂无课程」；邮件记录改为仅月度汇总（如「cct001提醒 17条」）；上传区增加常驻说明；筛选区简化。

---

## 一、全量测试方案（可设想的全部测试场景）

以下按**功能域**与**用户类型**穷举可执行的测试思路，便于回归与上线前验收。

### 1.1 登录与账号

| 编号 | 场景 | 操作 | 预期 | 备注 |
|------|------|------|------|------|
| L01 | 空邮箱获取验证码 | 邮箱为空，点「获取验证码」 | 前端校验或后端 400，提示「请输入邮箱」 | 避免无效请求 |
| L02 | 非 xjtlu 邮箱 | 输入 `a@qq.com`，获取验证码 | 400，Toast「仅支持 xjtlu.edu.cn 邮箱」；页面常驻文案可见 | **已改进** |
| L03 | 合法邮箱获取验证码 | `xxx@student.xjtlu.edu.cn`，获取验证码 | 200；Toast 生产「已发送至您的邮箱」/ 开发「请查看服务器日志」 | **已改进**（环境区分） |
| L04 | 验证码错误 1～4 次 | 故意输错 4 次登录 | 每次 401，「验证码错误或已过期」 | 不锁 |
| L05 | 验证码错误第 5 次 | 第 5 次错误登录 | 429，Toast「尝试次数过多，请 10 分钟后再试」 | **已改进** |
| L06 | 锁定期内再次登录 | 5 次错误后 2 分钟内再登录 | 429，同一文案 | 不暴露剩余时间 |
| L07 | 验证码过期 | 超过 5 分钟后用旧验证码登录 | 401，验证码错误或已过期 | - |
| L08 | 正确验证码登录 | 有效验证码登录 | 200，跳主页，localStorage 有 token | - |
| L09 | 登录后 401 行为 | 删除 token 或改 token 后请求任意接口 | 401 拦截，sessionStorage 写 reason，跳登录页，登录页 Toast「登录已过期，请重新登录」 | **已改进** |

### 1.2 主页：课程 CRUD 与未保存

| 编号 | 场景 | 操作 | 预期 | 备注 |
|------|------|------|------|------|
| H01 | 空状态 | 新用户无课程 | 仅「上传图片（含常驻"暂仅支持手动录入"）」「添加新课程」和置灰「确定」 | **二次已改进** |
| H02 | 添加新课程 | 点「添加新课程」 | 列表底新增一行，默认周一 08:00–10:00，课程名空；确定可点 | - |
| H03 | 编辑不点确定就切 tab | 改一门课或开关提醒后点「课程表」 | 弹窗「当前修改未保存，是否离开？」；选取消留在主页 | **已改进** |
| H04 | 编辑后点确定 | 改多门课后点「确定（N 项未保存）」 | 全部成功 Toast「全部保存成功（N 门）」；部分失败列出失败课程 | **已改进** |
| H05 | 删除已编辑未保存的课 | 编辑某课未确定，再删该课，再点确定 | 不向已删 id 发 PUT（dirtyIds 已移除该 id） | **已改进** |
| H06 | 删除课程 | 点某课删除 | 该条消失，dirtyIds 若有则移除；其他未保存仍可确定 | - |
| H07 | 上传图片入口 | 点「上传图片 自动识别」 | Toast「AI 识别功能开发中，请手动录入」+ 区块内常驻「暂仅支持手动录入」 | **二次已改进** |
| H08 | 课程名过长 | 输入超长课程名（如 80 字） | 可保存；课程表/列表展示不撑破布局，多行或截断 | 长期用户场景 |
| H09 | 未保存数量文案 | 有 3 处未保存 | 显示「您有 3 处未保存修改」+ 按钮「确定（3 项未保存）」 | **已改进** |

### 1.3 课程表页

| 编号 | 场景 | 操作 | 预期 | 备注 |
|------|------|------|------|------|
| S01 | 与主页数据一致 | 主页确定保存后切到课程表 | 课程表展示刚保存的数据（含新课、提醒状态） | **已改进** refreshKey |
| S02 | 语义文案 | 查看任意课程卡片 | 显示「已开启提醒」/「未开启提醒」而非「已推送/未推送」 | **已改进** |
| S03 | 竖线横线贯穿、无滚动条 | 左侧上午/下午 + 7 列（周一～周日），2 行×7 格共 14 格；格内多课垂直堆叠，页面向下延伸；无表格水平滚动、无格内垂直滚动 | 空格显示「暂无课程」；行高 auto，横平竖直 | **二次已改进** |
| S04 | 课程名多行 | 课程名很长 | 多行显示、line-clamp-2，不溢出卡片 | **已改进** |
| S05 | 时间范围显示 | 每张卡片 | 显示「开始时间 – 结束时间」，字体 mono，清晰易读 | **二次已改进** |

### 1.4 邮件记录与测试发信

| 编号 | 场景 | 操作 | 预期 | 备注 |
|------|------|------|------|------|
| E01 | 无记录 | 新用户从未收过提醒 | 「暂无邮件发送记录」 | - |
| E02 | 有记录月度汇总 | 有多条 sent_at 不同年/月 | 按年 > 月聚合，每月下每门课显示「课程名 N条」（如「cct001提醒 17条」），不展示具体时间 | **二次已改进** |
| E03 | 导出 CSV | 有记录时点「导出 CSV」 | 下载 CSV，含课程名称、发送时间、状态（完整明细） | - |
| E04 | 发送测试邮件 | 点「发送测试邮件」 | 请求 POST /email-logs/send-test-email，Toast「测试邮件已发送，请查收」 | **已改进** |
| E05 | 空课程名提醒记录 | 曾为未命名课程发过提醒 | 记录显示「未命名课程 提醒」 | **已改进** |

### 1.5 数据与环境（测试 vs 正式）

| 编号 | 场景 | 说明 | 建议 |
|------|------|------|------|
| D01 | 当前数据库 | 单一 `server/data/quiz.db`，所有用户共享同一库 | 生产部署建议：DB 路径或连接串由环境变量决定，与前端 API 基地址一致 |
| D02 | 历史测试数据 | 开发阶段产生的用户、课程、email_logs | **是否删除**：上线前需决策。方案 A：清空库或执行「重置测试数据」脚本；方案 B：保留并标注（如用户邮箱加后缀 _test），便于区分 |
| D03 | 测试/正式文件区分 | 前端 baseURL 写死 `localhost:5000`，后端 CORS 写死 `localhost:3000` | **正式上架**：API 基地址与 CORS 来源改为环境变量（如 VITE_API_BASE_URL、CORS_ORIGIN），构建时注入；测试环境可继续用 localhost |
| D04 | 多环境配置 | 无 NODE_ENV 或 APP_ENV 分支 | 建议：后端按 NODE_ENV 选择 DB 路径、日志级别；前端按 import.meta.env.MODE 或 VITE_APP_ENV 切换文案/功能（如开发才显示「验证码见服务器日志」） |

---

## 二、用户旅程模拟一：零经验大学生首次使用

**人物**：大一新生，第一次打开网站，无任何使用经验；设备上可能存在**历史测试数据**（取决于部署前是否清库）。

### 2.1 打开网页 → 登录

| 步骤 | 用户行为 | 系统表现 | 体验与风险 |
|------|----------|----------|------------|
| 1 | 从同学分享或搜索进入网站 | 深色登录页，标题「XJTLU Quiz Helper」，副标题「仅支持 @xjtlu.edu.cn 邮箱」 | 第一眼即知邮箱限制，减少误用 |
| 2 | 输入 QQ 邮箱，点「获取验证码」 | Toast「仅支持 xjtlu.edu.cn 邮箱」 | 明确拒绝原因 |
| 3 | 改用 `zhangsan@student.xjtlu.edu.cn`，点「获取验证码」 | Toast「验证码已发送至您的邮箱」（生产）或「请查看服务器日志」（开发） | 真实用户应收到邮件；开发环境需看终端 |
| 4 | 去邮箱收验证码（或开发环境看日志），输入 6 位码，点「登录」 | 进入主页，顶部「主页 / 课程表 / 邮件记录」+ 右侧头像 | 首登成功 |
| 5 | 若之前有人用同一库做过测试且未清数据 | 登录后仅看到**当前账号**的课程与邮件记录；不会看到其他测试账号数据 | **注意**：若从未做「清空测试数据」，库中可能有旧账号。当前设计按 user_id 隔离，零经验用户只会看到自己「空」的首页，不会直接看到他人课表；但若运营用同一库测试多账号，需避免把测试账号当真实用户 |

### 2.2 课表录入 → 开启提醒 → 确定

| 步骤 | 用户行为 | 系统表现 | 体验与风险 |
|------|----------|----------|------------|
| 6 | 点「上传图片 自动识别」 | Toast「AI 识别功能开发中，请手动录入」；区块下方常驻「暂仅支持手动录入」 | 期待落差最低 |
| 7 | 点「添加新课程」，改星期/时间，填「高等数学」 | 列表出现一行；底部出现「您有 1 处未保存修改」+「确定（1 项未保存）」 | 未保存状态清晰 |
| 8 | 不点确定，直接点「课程表」 | 弹窗「当前修改未保存，是否离开？」；选「取消」留在主页 | 避免误以为「已同步」 |
| 9 | 点「确定」 | Toast「已保存，课程表已更新」；再点「课程表」可见该课 | 流程闭环 |
| 10 | 回到主页，给该课开启 Quiz 提醒（实心圆），再点「确定」 | 提醒持久化；之后课前 5 分钟会发邮件 | 认知上已通过文案和确认弹窗强调「需点确定」 |

### 2.3 课程表页（二次改进后）

| 步骤 | 用户行为 | 系统表现 | 体验与风险 |
|------|----------|----------|------------|
| 11 | 点「课程表」 | 左侧「上午」「下午」+ 表头周一～周日；2 行×7 列共 14 格，竖线横线贯穿；格内多课垂直堆叠，页面向下延伸，无滚动条 | 布局整洁、横平竖直 |
| 12 | 有课的格 | 每张卡片：课程代号 + 起止时间（如 10:00 – 11:00）+「已开启提醒/未开启提醒」 | 一目了然 |
| 13 | 无课的格 | 统一占位「暂无课程」 | 视觉稳定 |

### 2.4 邮件记录页（二次改进后）

| 步骤 | 用户行为 | 系统表现 | 体验与风险 |
|------|----------|----------|------------|
| 14 | 点「邮件记录」 | 顶部「共 N 条发送记录」+「导出 CSV」「发送测试邮件」；下方按年 > 月聚合 | 信息密度合理，不展示每条记录的具体时间 |
| 15 | 查看某月 | 显示每门课的发送次数：如「cct001提醒 17条」「高等数学提醒 4条」 | 仅展示汇总，清爽不冗余 |
| 16 | 需要详细信息时 | 点「导出 CSV」 | CSV 内包含完整明细（课程名、时间、状态），满足分析需求 |

**零经验用户小结**：在二次改进后，首次使用路径清晰，课程表布局规整，邮件记录精简；唯一需在**上线前明确**的是：是否清空或隔离历史测试数据，以及正式环境与测试环境的配置分离。

---

## 三、用户旅程模拟二：使用 5 个月的大学生（长期用户）

**人物**：已使用一学期以上的学生，课表稳定、每周收到多次提醒，邮件记录已积累大量数据。

### 3.1 假设数据状态（5 个月后）

- **课程**：约 8～12 门课（学期内），分布在周一至周五 08:00–18:00；部分课程名较长（如「Introduction to Financial Accounting and Management」）。
- **提醒**：约 6～8 门课开启 Quiz 提醒；每周约 10～15 封提醒邮件（同一门课每周一次）。
- **邮件记录**：约 4～5 个月 × 每月约 40～60 条 ≈ **200～300 条** email_logs；按年/月聚合后展示为每门课的次数汇总。
- **学期更替**：可能已从秋季切到春季，旧学期课程是否保留、是否「归档」或「清空本学期」未定义，当前产品**未区分学期**，所有历史课程始终存在。

### 3.2 主页（HomeView）在 5 个月后的表现

| 项目 | 表现 | 问题/风险 |
|------|------|-----------|
| 列表长度 | 8～12 行课程，可滚动 | 一屏内尚可；若用户误加很多重复或历史课，列表会很长，无分页或「本学期」筛选 |
| 未保存提示 | 「您有 N 处未保存修改」+「确定（N 项未保存）」 | 仍有效 |
| 排序 | 「按时间排序」一次生效，无记忆 | 长期用户可能期望默认按星期+时间排，且记住偏好 |
| 上传图片区 | 常驻「暂仅支持手动录入」 | **二次已改进**，期待落差最低 |

### 3.3 课程表页（ScheduleView）在 5 个月后的表现

| 项目 | 表现 | 问题/风险 |
|------|------|-----------|
| 布局 | 左侧上午/下午 + 7 列，2×7 格；竖线横线贯穿；格高自适应，无滚动条 | **二次已改进**；布局稳定 |
| 卡片内容 | 课程代号 + 起止时间（如 10:00 – 11:00）+「已开启提醒/未开启提醒」 | 一目了然 |
| 信息量 | 若某天课多（5+门），列会较长 | 各列统一最大高度后底部对齐，视觉稳定 |
| 语义 | 「已开启提醒」/「未开启提醒」 | 语义清晰；长期用户可能进一步期望「本周已提醒」标记 |

### 3.4 邮件记录页（EmailRecordsView）在 5 个月后的表现

| 项目 | 表现 | 问题/风险 |
|------|------|-----------|
| 月度汇总 | 每月仅显示课程名+次数（如「cct001提醒 17条」） | **二次已改进**；200+ 条仅聚合为数十行汇总，DOM 极轻量 |
| 总数提示 | 顶部「共 N 条发送记录」 | 清晰 |
| 导出 CSV | 可一键导出完整明细 | 需要具体时间时走 CSV |
| 发送测试邮件 | 入口保留在顶栏 | 长期用户偶尔检查收件是否正常 |

### 3.5 长期用户特有痛点归纳

1. **无学期概念**：历史课与当前课混在一起，无法「只看本学期」或「归档旧学期」。
2. **课表「本周已提醒」缺失**：已开启提醒的课无法一眼看出「这周是否已经发过邮件」，只能去邮件记录里查。
3. **无数据导出/备份**：除邮件记录 CSV 外，课表本身无法导出或备份，换设备/清缓存后依赖服务器。
4. **排序无记忆**：每次进主页默认列表顺序为接口返回顺序，需手动点「按时间排序」。

---

## 四、测试数据与正式上架的环境区分建议

### 4.1 历史测试数据是否删除

| 策略 | 做法 | 适用 |
|------|------|------|
| **上线前清空** | 执行脚本删除所有 users / courses / email_logs，或使用新的空 DB 文件 | 正式环境首次上线，希望用户从零开始 |
| **保留但隔离** | 测试阶段使用独立 DB（如 `quiz-test.db`）或独立环境（如 test.xxx.com），正式环境用 `quiz.db` 或 prod 库 | 需要保留测试数据做回归，又不影响生产 |
| **标记测试账号** | 测试账号邮箱统一后缀（如 `_test@student.xjtlu.edu.cn`），上线前只删除这类用户及其关联数据 | 混合库时区分「真人」与「测试」 |

建议：**至少做 4.1 的策略选择并文档化**；若有自动化部署，建议「正式环境」使用独立 DB 路径且不在该环境跑种子数据。

### 4.2 测试文件与正式文件的区分

| 层级 | 当前 | 建议 |
|------|------|------|
| **前端 API 基地址** | 写死 `http://localhost:5000/api` | 使用 `import.meta.env.VITE_API_BASE_URL` 或类似，开发默认 localhost，生产构建时注入正式 API 地址 |
| **后端 CORS** | `origin: 'http://localhost:3000'` | 使用环境变量 `CORS_ORIGIN`，生产为正式前端域名 |
| **后端 DB 路径** | 固定 `server/data/quiz.db` | 可选：`process.env.DATABASE_PATH` 或 `NODE_ENV === 'production' ? 'prod.db' : 'quiz.db'` |
| **验证码/邮件文案** | 已按 import.meta.env.DEV 区分 | 保持；可再增加 `VITE_APP_ENV=test` 用于预发环境 |
| **构建产物** | 前端 build 输出到 dist | 正式上架使用该产物，并确保 API 基地址指向生产后端 |

---

## 五、二次改进痛点汇总与建议

在**一次改进已落地 + 二次迭代已实施**的前提下，标注落实情况。

### 已落实项（二次迭代）

| 项目 | 改进内容 | 状态 |
|------|----------|------|
| 课程表布局 | 左侧时间轴（上午/下午）+ 周一～周日 7 列，2×7 共 14 格；竖线横线贯穿；格高 auto、多课堆叠页面向下延伸；禁止表格与格内滚动条；空格「暂无课程」 | **已落实** |
| 邮件记录 | 移除具体内容展示，改为按年/月聚合仅显示「课程名 N条」汇总 | **已落实** |
| 邮件记录筛选 | 移除课程名/日期范围筛选（汇总视图无需逐条筛选），保留 CSV 导出完整明细 | **已落实** |
| 上传图片区常驻说明 | 在「上传图片 自动识别」区块内增加常驻文案「暂仅支持手动录入」 | **已落实** |
| 课程表卡片时间与语义 | 每张卡片显示「起始时间 – 结束时间」、课程代号、状态「已开启提醒/未开启提醒」 | **已落实** |

### P0（影响核心目标与数据可信度）

| 痛点 | 建议 | 状态 |
|------|------|------|
| 测试数据与正式数据未分离，上线后可能残留或混淆 | ① 明确「上线前是否清空/迁移数据」并文档化；② 正式环境使用独立 DB；③ API 基地址与 CORS 由环境变量配置 | 待落实 |
| 长期用户课表与邮件记录无「学期」维度 | ① 课程表增加「学期」字段或「开始/结束日期」；② 列表与课程表支持按学期筛选 | 待落实 |

### P1（明显体验与性能）

| 痛点 | 建议 | 状态 |
|------|------|------|
| 长期用户无法一眼看出「本周该课是否已发过提醒」 | 课程表卡片增加「本周已提醒」标记（需后端按 user_id + course_id + 本周范围查 email_logs） | 待落实 |
| 课表数据无法导出/备份 | 提供「导出课表」（JSON 或 CSV），便于备份 | 待落实 |

### P2（优化与美感）

| 痛点 | 建议 | 状态 |
|------|------|------|
| 无「本学期」快捷筛选 | 在邮件记录页增加「本学期」按钮（基于学期日期范围重新拉数据） | 待落实 |
| Toast 仅约 4 秒，重要失败信息易错过 | 对「部分保存失败」「发送失败」等可考虑略长 TTL 或常驻直到用户关闭 | 待落实 |
| 排序无记忆 | 默认按星期+时间排序或用 localStorage 记忆偏好 | 待落实 |

---

## 六、小结

- **测试方案**：已覆盖登录、主页 CRUD、未保存与离开确认、课程表布局与语义、邮件记录月度汇总与测试发信、以及**数据与环境区分**。
- **零经验用户**：在二次改进后，全流程顺畅，课程表布局整洁无空缺，邮件记录精简为月度汇总。
- **5 个月长期用户**：邮件记录由 200+ 条聚合为数十行汇总，性能与可读性显著提升；课程表竖线贯穿布局稳定；仍需关注学期维度与「本周已提醒」等后续需求。
- **二次改进已落实**：课程表为上午/下午 2×7 格、竖横线贯穿、自适应高度无滚动条、卡片起止时间与「已开启提醒/未开启提醒」、空格「暂无课程」；邮件记录仅月度汇总；上传区常驻说明。
- **后续重点**：① 环境与数据策略文档化；② 学期字段与筛选；③ 本周已提醒标记；④ 课表导出；⑤ Toast 策略与排序记忆。

建议落地顺序：先落实 **P0 环境与数据策略**，再做 **P1 学期与本周提醒**，最后视需要做 **P2 美感与快捷操作**。
