# 免费部署试用（先不花钱体验）

想先不买服务器、在免费平台上跑起来用一用，可以按下面两种方式选一种。**免费档有使用限制**（如休眠、数据不持久），适合「先体验流程」，正式用再买国内/香港服务器。

---

## 方式一：Render（推荐，最简单）

**特点**：免费档免费用、无需信用卡（部分地区需绑卡）、连 GitHub 即可部署，约 5 分钟可打开链接试用。  
**限制**：免费实例约 15 分钟无访问会休眠，下次打开要等几十秒唤醒；**重启/重新部署后数据库会清空**（不适合长期存数据）。

### 步骤

1. **代码已在 GitHub**  
   确保项目已推送到 GitHub（仓库名如「校园quiz提醒」）。

2. **注册 Render**  
   打开 [https://render.com](https://render.com) → 用 GitHub 登录。

3. **新建 Web Service**  
   - 点击 **New +** → **Web Service**  
   - 选你的 GitHub 仓库（若未授权先授权 Render 访问）  
   - 配置如下：

   | 项 | 填写的值 |
   |----|----------|
   | **Name** | 随意，如 `xjtlu-quiz-helper` |
   | **Region** | 选 **Singapore**（离国内相对近） |
   | **Branch** | `main` 或 `master` |
   | **Runtime** | **Node** |
   | **Build Command** | `npm run install:all && npm run build` |
   | **Start Command** | `NODE_ENV=production node server/index.js` |
   | **Instance Type** | **Free** |

4. **环境变量**  
   在 **Environment** 里添加：

   | Key | Value |
   |-----|--------|
   | `NODE_ENV` | `production` |
   | `JWT_SECRET` | 随便一串长字符（如 `my-secret-key-32-chars-long!!`） |

5. **部署**  
   点 **Create Web Service**，等构建和部署完成（约 3～5 分钟）。  
   完成后会给你一个地址：**https://xxx.onrender.com**，用浏览器打开即可试用。

6. **使用说明**  
   - 当前为「仅邮箱登录」、无验证码，用任意 @xjtlu.edu.cn 邮箱即可登录。  
   - 若一段时间没访问，再打开会较慢（休眠唤醒），属正常。  
   - 若你点了 **Manual Deploy** 或推送代码触发重新部署，**课程和邮件记录会清空**（免费档无持久化磁盘）。

---

## 方式二：Fly.io（免费 + 数据可持久）

**特点**：免费额度内可挂载小容量持久盘，**重启/部署后数据库可保留**，更适合当「长期免费试用」。  
**限制**：需要本机装 `flyctl` 并用命令行部署，步骤比 Render 多。

### 步骤概要

1. **安装 flyctl**  
   - Windows：`powershell -Command "iwr https://fly.io/install.ps1 -useb | iex"`  
   - 或见 [https://fly.io/docs/hands-on/install-flyctl](https://fly.io/docs/hands-on/install-flyctl)

2. **登录**  
   ```bash
   fly auth login
   ```

3. **在项目根目录初始化并部署**  
   ```bash
   cd 你的项目根目录
   fly launch --no-deploy
   ```  
   按提示选 region（如香港 `hkg`）、App 名称等；若问是否部署 PostgreSQL 选 **No**（我们用 SQLite）。

4. **创建持久化卷（存 SQLite）**  
   ```bash
   fly volumes create data --size 1 --region hkg
   ```  
   记下卷名（如 `vol_xxxx`）。

5. **配置挂载与启动**  
   在项目根目录创建或修改 `fly.toml`，在 `[http_service]` 或 `[app]` 同级增加：
   ```toml
   [mounts]
   source = "data"
   destination = "/data"
   ```
   并确保有：
   ```toml
   [env]
     NODE_ENV = "production"
     DATABASE_PATH = "/data/quiz.db"
   ```
   Start 命令设为：`NODE_ENV=production node server/index.js`（或通过 `[processes]` 配置）。

6. **部署**  
   ```bash
   fly deploy
   ```

7. **打开链接**  
   ```bash
   fly open
   ```  
   会打开浏览器，即可试用；数据会写在卷里，重启/ redeploy 一般不会丢。

---

## 对比小结

| 项目 | Render 免费 | Fly.io 免费 |
|------|-------------|-------------|
| 上手难度 | 很低（网页点选） | 中等（需命令行） |
| 数据是否持久 | 否（重启/部署会清空） | 是（挂卷后持久） |
| 休眠 | 约 15 分钟无访问休眠 | 一般不休眠（看方案） |
| 国内访问 | 可能较慢或需代理 | 选香港节点相对好 |

**建议**：只想「先打开用一下」→ 用 **Render**；想「免费且数据不丢」→ 用 **Fly.io** 并挂卷。  
正式给同学/用户用、要稳定和国内访问好，再按《部署指南》买阿里云/腾讯云即可。
