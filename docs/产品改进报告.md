# XJTLU Quiz Helper 产品改进报告

**角色**：产品测试（注重美感与细节）  
**范围**：从打开网页到完成课表录入并收到 Quiz 提醒的全流程 + 预判用户操作与痛点  
**结论**：全流程可走通，但存在多处体验与认知偏差，需改进以降低困惑与误操作。

---

## 一、全流程模拟：一名需要提醒的大学生

### 1.1 打开网页 → 登录

| 步骤 | 用户操作 | 系统表现 | 问题/风险 |
|------|----------|----------|-----------|
| 1 | 打开 http://localhost:3000 | 深色登录页，邮箱 + 验证码输入框 | 无 |
| 2 | 输入 `xxx@qq.com`，点「获取验证码」 | 后端校验仅允许 `@xjtlu.edu.cn`，返回 400；Toast 提示「仅支持 xjtlu.edu.cn 邮箱」 | **痛点**：非校内邮箱用户不知道必须用校内邮箱，易以为「发码失败」 |
| 3 | 改用 `xxx@student.xjtlu.edu.cn`，点「获取验证码」 | 成功；Toast「验证码已发送，请查看控制台（后端会打印验证码）」 | **痛点**：真实用户不会开控制台；应改为「验证码已发送至您的邮箱」或开发环境单独提示「开发模式：验证码见服务器日志」 |
| 4 | 未收邮件（因当前为控制台打印），随便输入 6 位验证码，点「登录」 | 401，Toast「验证码错误或已过期」 | 符合预期 |
| 5 | 从后端终端看到验证码，输入正确验证码并登录 | 进入主页，顶部「主页 / 课程表 / 邮件记录」+ 右侧头像 | 无 |

### 1.2 课表录入 → 开启提醒 → 确定

| 步骤 | 用户操作 | 系统表现 | 问题/风险 |
|------|----------|----------|-----------|
| 6 | 点击「上传图片 自动识别」 | Toast「AI 识别功能开发中，请手动录入」 | 预期内；可考虑在区块内常驻一句「暂仅支持手动录入」 |
| 7 | 点「添加新课程」 | 列表底部新增一行：周一 08:00–10:00，课程名空 | 无 |
| 8 | 改星期为「周三」，开始 10:00，结束 11:00，课程名「高等数学」 | 仅前端变化；底部「确定」变为可点 | **认知**：部分用户可能以为已保存，直接切到课程表 |
| 9 | 不点「确定」，直接点导航「课程表」 | 课程表页展示的是**上次保存的数据**，刚加的课若从未点过确定则**不会出现** | **痛点**：编辑后未点确定就离开，会误以为「没保存上」或「课程表不同步」 |
| 10 | 返回主页，点「确定」 | 请求 PUT；Toast「已保存，课程表已更新」；「确定」再次置灰 | 无 |
| 11 | 再点「课程表」 | 新课程出现在对应周三上午格子里 | 无 |
| 12 | 返回主页，点击该课程左侧圆圈开启 Quiz 提醒（实心） | 仅本地状态变化；「确定」再次可点 | **认知**：用户可能以为「开了提醒就生效」，未意识到还需点「确定」 |
| 13 | 点「确定」 | 提醒开关被持久化；定时任务之后会按规则发邮件 | 无 |

### 1.3 等待提醒 → 收信 → 邮件记录

| 步骤 | 用户操作 | 系统表现 | 问题/风险 |
|------|----------|----------|-----------|
| 14 | 不关页面，等到「当前星期 + 上课时间前 5 分钟」 | 后端每分钟轮询；若当前为周三 09:55（上海时区），且有一门 10:00 的课且开了提醒，则发信 | **痛点**：提醒依赖「当前星期几」与「当前时间」，无具体日期；若学期有单双周、假期，可能误发或漏发 |
| 15 | 登录邮箱（xjtlu 邮箱） | 收到主题「Quiz 提醒: 高等数学」，正文为约 5 分钟后上课 | 无（前提 SMTP 已配置） |
| 16 | 点「邮件记录」 | 按年/月聚合展示发送记录，可筛选、导出 CSV | 无 |

---

## 二、预判用户操作与潜在问题

### 2.1 登录与账号

- **用非 xjtlu 邮箱**：被拒，需在界面明确写「仅支持 @xjtlu.edu.cn 邮箱」。
- **验证码来源**：当前成功文案引导「查看控制台」，真实用户应看邮箱；需区分环境或改为「已发送至邮箱」。
- **连续输错 5 次验证码**：会触发 10 分钟锁定（429），但界面只显示「验证码错误或已过期」，用户不知道被锁，易反复重试。

### 2.2 主页与确定

- **编辑后不点确定就切到课程表**：课程表与邮件记录的数据来自接口，未点确定时不会包含未保存修改，用户易认为「数据丢了」或「不同步」。
- **未保存提示**：当前仅靠「确定」可点击表示有未保存修改；无「您有未保存的修改」文案或离开前二次确认。
- **删除已编辑但未确定的课程**：删除是即时请求，该条从列表消失，dirtyIds 中若含该 id 仍存在；点确定时会对已删 id 发 PUT（后端 404）。应：删除时从 dirtyIds 移除该 id。
- **多门课批量编辑后点确定**：确定会顺序 PUT，若中途某一门失败（如网络/校验），已保存的不会回滚，未保存的需用户再次点确定；可考虑「部分成功」提示（如「3 门已保存，1 门失败」）。

### 2.3 课程表页

- **「已推送 / 未推送」语义**：当前表示「是否开启 Quiz 提醒」，而非「本周是否已发过邮件」。用户易理解为「这节已经提醒过了」，造成语义混淆。
- **课程表数据新鲜度**：ScheduleView 仅在 mount 时拉一次课程；用户在主页点确定后不刷新课程表页，需用户手动切走再切回或刷新才看到最新数据。

### 2.4 提醒与发信

- **发信时间窗口**：scheduler 仅在「当前分钟 = 上课时间 - 5 分钟」的那一分钟内发信（如 10:00 的课在 09:55 这一分钟触发）。若服务在那分钟重启或异常，会错过当次提醒。
- **无「测试发信」**：用户无法在设置完 SMTP 后立刻验证能否收到邮件，只能等到真实上课前 5 分钟。
- **空课程名**：课程名为空时存为 `''`，邮件主题为「Quiz 提醒: 」，观感差；可统一展示为「未命名课程」或录入时弱提示「建议填写课程名」。

### 2.5 体验细节

- **确定按钮**：无「未保存数量」提示（如「确定（3 项未保存）」），用户不清楚要保存多少条。
- **Toast 自动消失**：约 4 秒消失，若用户当时在看别处，可能错过成功/失败信息。
- **401 跳转**：Token 过期或无效时直接 `window.location.href = '/'`，无「登录已过期，请重新登录」的 Toast，体验略生硬。

---

## 三、痛点汇总与改进建议

### P0（影响完成核心目标）

| 痛点 | 建议 |
|------|------|
| 编辑/开关提醒后未点「确定」就离开，课程表与记录不同步 | ① 在顶部或确定按钮旁常驻「您有 X 处未保存修改」；② 从主页切到课程表/邮件记录时，若 dirtyIds 非空，先弹确认「当前修改未保存，是否离开？」 |
| 课程表页「已推送/未推送」与用户理解不一致 | 改为「已开启提醒 / 未开启提醒」，或单独增加「本周已提醒」逻辑（需后端/前端按「本周是否已发信」计算） |
| 课程表页 [课程添加后出现了上下排版没对齐的问题，需要固定每格空间大小，课程名过长考虑增加每格宽度让课程名用多行显示]
| 验证码成功文案引导「查看控制台」 | 生产环境改为「验证码已发送至您的邮箱」；开发环境可保留控制台提示或单独说明 |

### P1（明显体验问题）

| 痛点 | 建议 |
|------|------|
| 删除一条已编辑但未确定的课程后，再点确定会对其发 PUT 导致 404 | 删除课程时从 dirtyIds 中移除该 id |
| 课程表页不随主页「确定」自动更新 | 方案 A：课程表页定时或获得焦点时重新拉列表；方案 B：全局事件/状态（如「课程已保存」），ScheduleView 监听后 refetch |
| 确定时部分成功、部分失败无明确反馈 | 确定后按结果 Toast：「全部保存成功」或「3 门已保存，1 门保存失败」，失败时列出课程名或 id |
| 非 xjtlu 邮箱被拒时不知道原因 | 登录页副标题或邮箱框下方常驻一句：「仅支持 @xjtlu.edu.cn 邮箱」 |

### P2（优化与细节）

| 痛点 | 建议 |
|------|------|
| 无「测试发信」入口 | 在邮件记录页或设置区增加「发送测试邮件」按钮，调用后端发一封到当前用户邮箱 |
| 课程名为空时邮件主题不友好 | 发信时若 name 为空则用「未命名课程」；或在录入侧 placeholder/校验弱提示 |
| 验证码 5 次锁定无说明 | 返回 429 时 Toast 明确写「尝试次数过多，请 10 分钟后再试」 |
| Token 过期直接跳转 | 401 时先 Toast「登录已过期，请重新登录」，再短延时跳转登录页 |

---

## 四、小结

- **全流程**：从打开网页 → 校内邮箱登录 → 手动录入课程 → 开启提醒 → 点确定 → 到课前 5 分钟收邮件 → 在邮件记录中查看，**可以完整跑通**。  
- **主要风险**：未保存就离开导致「课程表/记录与预期不符」、「已推送/未推送」语义与认知不符、验证码与邮箱限制说明不足。  
- **建议落地顺序**：先做 P0（未保存提示/离开确认、文案与语义统一、验证码成功文案），再做 P1（删除与 dirtyIds、课程表刷新、确定结果反馈、邮箱限制说明），最后视资源做 P2（测试发信、空课程名、锁定与 401 提示）。
